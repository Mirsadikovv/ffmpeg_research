# Transcoder Framework

–ü—Ä–æ—Å—Ç–æ–π –∏ –º–æ—â–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ –Ω–∞ Go —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FFmpeg.

üìñ **[–ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ FFmpeg](FFMPEG_REFERENCE.md)** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≤—Å–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º FFmpeg

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üé• –¢—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤
- üîß –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- üìã –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- üîÑ –°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏
- üìä –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞—Ö
- üöÄ –ü—Ä–æ—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π API

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
go get github.com/your-username/transcoder
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ FFmpeg —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ:

```bash
# Ubuntu/Debian
sudo apt install ffmpeg

# macOS
brew install ffmpeg

# Windows
# –°–∫–∞—á–∞–π—Ç–µ —Å https://ffmpeg.org/download.html
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```go
package main

import (
    "context"
    "log"
    "transcoder"
)

func main() {
    // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω—Å–∫–æ–¥–µ—Ä
    tc, err := transcoder.New("ffmpeg")
    if err != nil {
        log.Fatal(err)
    }

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    config := transcoder.Config{
        InputPath:    "input.mp4",
        OutputPath:   "output.mp4",
        VideoCodec:   "libx264",
        AudioCodec:   "aac",
        VideoBitrate: "1000k",
        AudioBitrate: "128k",
    }

    // –°–æ–∑–¥–∞–µ–º –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–¥–∞—á—É
    job := tc.CreateJob(config)
    ctx := context.Background()
    
    if err := tc.Execute(ctx, job); err != nil {
        log.Fatal(err)
    }
    
    log.Println("–¢—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–æ–≤

```go
// –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ—Å–µ—Ç
preset, exists := transcoder.GetPreset("web-hd")
if !exists {
    log.Fatal("–ü—Ä–µ—Å–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
}

// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—É—Ç–∏
config := preset.Config
config.InputPath = "input.mp4"
config.OutputPath = "output_hd.mp4"

// –í—ã–ø–æ–ª–Ω—è–µ–º —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
job := tc.CreateJob(config)
tc.Execute(ctx, job)
```

## –†–∞–±–æ—Ç–∞ —Å –æ—á–µ—Ä–µ–¥—å—é

```go
// –°–æ–∑–¥–∞–µ–º –æ—á–µ—Ä–µ–¥—å —Å 2 –≤–æ—Ä–∫–µ—Ä–∞–º–∏
queue := transcoder.NewQueue(tc, 2)
queue.Start()

// –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏
for i := 0; i < 5; i++ {
    config := transcoder.Config{
        InputPath:  fmt.Sprintf("input%d.mp4", i),
        OutputPath: fmt.Sprintf("output%d.mp4", i),
        VideoCodec: "libx264",
        AudioCodec: "aac",
    }
    job := tc.CreateJob(config)
    queue.AddJob(job)
}

// –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—á–µ—Ä–µ–¥—å
defer queue.Stop()
```

## –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã

### –í–µ–± –∏ –º–æ–±–∏–ª—å–Ω—ã–µ
- `web-hd` - HD –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –≤–µ–± (1280x720, H.264)
- `web-sd` - SD –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –≤–µ–± (854x480, H.264)
- `mobile` - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- `4k` - 4K –∫–∞—á–µ—Å—Ç–≤–æ (3840x2160, H.264)
- `archive` - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è (H.265, FLAC)

### –°—Ç—Ä–∏–º–∏–Ω–≥
- `twitch` - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è Twitch —Å—Ç—Ä–∏–º–∞ (1080p60)
- `youtube` - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è YouTube (1080p30)

### –ê—É–¥–∏–æ
- `audio-mp3` - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ MP3
- `audio-aac` - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ AAC

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ë—ã—Å—Ç—Ä–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
```go
// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
tc.ConvertToFormat("input.mp4", "output.webm", "webm")
tc.ConvertToFormat("video.mov", "audio.mp3", "mp3")
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ
```go
// –ò–∑–≤–ª–µ—á—å –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫—É –∏–∑ –≤–∏–¥–µ–æ
tc.ExtractAudio("video.mp4", "audio.mp3")
```

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä
```go
// –°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–∞—Ç—é—Ä—É –Ω–∞ 10-–π —Å–µ–∫—É–Ω–¥–µ
tc.CreateThumbnail("video.mp4", "thumb.jpg", "00:00:10")
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```go
// –£–∑–Ω–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞
duration, err := tc.GetDuration("video.mp4")
```

## API Reference

### Transcoder

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- `New(ffmpegPath string) (*Transcoder, error)` - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Ç—Ä–∞–Ω—Å–∫–æ–¥–µ—Ä
- `CreateJob(config Config) *Job` - —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á—É —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- `Execute(ctx context.Context, job *Job) error` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `GetInfo(filePath string) (map[string]interface{}, error)` - –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ

#### –£–¥–æ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- `ConvertToFormat(inputPath, outputPath, format string) error` - –±—ã—Å—Ç—Ä–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- `ExtractAudio(inputPath, outputPath string) error` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ
- `CreateThumbnail(inputPath, outputPath, timeOffset string) error` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä—ã
- `GetDuration(filePath string) (string, error)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Queue

- `NewQueue(transcoder *Transcoder, workers int) *Queue` - —Å–æ–∑–¥–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å
- `AddJob(job *Job)` - –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
- `Start()` - –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—á–µ—Ä–µ–¥–∏
- `Stop()` - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Makefile –∫–æ–º–∞–Ω–¥—ã
```bash
make help          # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make check-ffmpeg  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ FFmpeg
make example       # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–º–µ—Ä
make test          # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make test-coverage # –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
make bench         # –ë–µ–Ω—á–º–∞—Ä–∫–∏
make fmt           # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
make check         # –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
go test -v ./...

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
go test -v -coverprofile=coverage.out ./...
go tool cover -html=coverage.out

# –ë–µ–Ω—á–º–∞—Ä–∫–∏
go test -bench=. -benchmem ./...
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
transcoder/
‚îú‚îÄ‚îÄ transcoder.go      # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å
‚îú‚îÄ‚îÄ presets.go         # –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ queue.go           # –°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π
‚îú‚îÄ‚îÄ transcoder_test.go # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ example/
‚îÇ   ‚îî‚îÄ‚îÄ main.go        # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ FFMPEG_REFERENCE.md # –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ FFmpeg
‚îú‚îÄ‚îÄ Makefile           # –ö–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏
‚îî‚îÄ‚îÄ README.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License